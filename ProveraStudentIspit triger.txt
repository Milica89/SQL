

--proverava da li student moze da polaze uneti ispit

CREATE TRIGGER ProveraStudentIspit ON ISPIT
INSTEAD OF INSERT
AS 
BEGIN
	IF 
		(SELECT PSG.GODINA_ID 
		FROM inserted INS
		JOIN PREDMET_SMER_GODINA PSG ON PSG.PREDMET_ID=INS.PREDMET_ID)=
		(SELECT SSG.GODINA_ID
		FROM inserted INS
		JOIN STUDENT_SMER_GODINA SSG ON SSG.STUDENT_ID=INS.STUDENT_ID)
		AND
		(SELECT PSG.SMER_ID 
		FROM inserted INS
		JOIN PREDMET_SMER_GODINA PSG ON PSG.PREDMET_ID=INS.PREDMET_ID)=
		(SELECT SSG.SMER_ID
		FROM inserted INS
		JOIN STUDENT_SMER_GODINA SSG ON SSG.STUDENT_ID=INS.STUDENT_ID)
		BEGIN
			INSERT INTO ISPIT (PREDMET_ID, STUDENT_ID, OCENA, DATUM)
			SELECT INS.PREDMET_ID, INS.STUDENT_ID, INS.OCENA, INS.DATUM
			FROM inserted INS
			PRINT 'ocena uneta u bazu'
		END
	ELSE
		PRINT 'student nema mogucnost da polaze taj ispit'
END
GO
